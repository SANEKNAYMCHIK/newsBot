# Наименование
## Агрегатор новостных лент
# Описание
Система для автоматического сбора, обработки и персонализированной доставки новостного контента через Telegram-бота и веб-интерфейс. Пользователи могут настраивать источники новостей. Система обеспечивает модерацию контента и предотвращение информационной перегрузки.
# Предметная область
1. Управление новостными потоками\
Автоматический парсинг и обновление новостей из RSS-лент\
Категоризация новостей\
Отсутствие дублирующегося контента

2. Персонализация контента\
Система подписок на интересующие новостные источники\
Управление частотой и временем доставки уведомлений

3. Многоуровневая система доставки контента\
Push-уведомления в реальном времени через Telegram\
Отложенная доставка по расписанию\
Веб-интерфейс для углубленного изучения контента

4. Администрирование и модерация\
Управление источниками новостей (добавление/блокировка)\
Аналитика популярности контента и источников

5. Техническая инфраструктура\
Оптимизация производительности через кеширование\
Защита от спама и злоупотреблений

# Данные
1. Структурированные данные (PostgreSQL)\
Пользователи: идентификаторы Telegram, имена, настройки
Источники новостей: RSS-ленты, категории, параметры обновления\
Новостные статьи: заголовки, контент, ссылки, связи с источниками и категориями\
Система подписок: связи пользователей с категориями, настройки уведомлений\
Модерация: изменение/удаление новостных лент, просмотр новостных публикаций, журнал действий администраторов

2. Внешние данные
RSS-ленты: XML-потоки новостных изданий\
Telegram API: данные пользователей, состояния чатов

## Для каждого элемента данных - ограничения
**Таблица `users`**
```sql
users (
  id BIGSERIAL PRIMARY KEY,
  email VARCHAR(255) UNIQUE,          -- максимум 255 символов, уникальный
  password_hash VARCHAR(255) NOT NULL, -- обязательное поле
  tg_id BIGINT UNIQUE,                -- уникальный Telegram ID
  tg_username VARCHAR(255),           -- максимум 255 символов
  tg_first_name VARCHAR(255),
  role VARCHAR(20) DEFAULT 'user'     -- только 'user' или 'admin'
  created_at TIMESTAMP DEFAULT NOW()  -- автоматическое заполнение
)
```
**Таблица `categories`**
```sql
categories (
  id SERIAL PRIMARY KEY,
  name VARCHAR(100) NOT NULL UNIQUE,  -- обязательно, уникально, 100 символов
  description TEXT,                   -- неограниченный текст
  created_at TIMESTAMP DEFAULT NOW()
)
```
**Таблица `sources`**
```sql
sources (
  id SERIAL PRIMARY KEY,
  name VARCHAR(200) NOT NULL,         -- обязательно, 200 символов
  url VARCHAR(500) NOT NULL UNIQUE,   -- обязательно, уникально, 500 символов
  category_id INT NOT NULL,           -- внешний ключ, обязательно
  user_id BIGINT,                     -- кто добавил источник
  is_active BOOLEAN DEFAULT TRUE,     -- true/false
  created_at TIMESTAMP DEFAULT NOW(),
  FOREIGN KEY (category_id) REFERENCES categories(id),
  FOREIGN KEY (user_id) REFERENCES users(id)
)
```
**Таблица `news_items`**
```sql
news_items (
  id BIGSERIAL PRIMARY KEY,
  title TEXT NOT NULL,                -- обязательно
  content TEXT,                       -- может быть NULL
  url VARCHAR(500) NOT NULL UNIQUE,   -- обязательно, уникально, 500 символов
  published_at TIMESTAMP NOT NULL,    -- обязательно
  source_id INT NOT NULL,             -- внешний ключ, обязательно
  created_at TIMESTAMP DEFAULT NOW(),
  guid VARCHAR(500),                  -- для дедупликации
  FOREIGN KEY (source_id) REFERENCES sources(id),
  UNIQUE(source_id, guid)             -- уникальная комбинация источник+GUID
)
```
**Таблица `user_sources`**
```sql
user_sources (
  user_id BIGINT NOT NULL,            -- внешний ключ
  source_id INT NOT NULL,             -- внешний ключ
  created_at TIMESTAMP DEFAULT NOW(),
  PRIMARY KEY (user_id, source_id),   -- составной первичный ключ
  FOREIGN KEY (user_id) REFERENCES users(id),
  FOREIGN KEY (source_id) REFERENCES sources(id)
)
```
## Общие ограничения целостности
users.email - уникальный email\
users.tg_id - уникальный Telegram ID\
sources.url - уникальный URL источника\
news_items.url - уникальный URL новости\
news_items(source_id, guid) - уникальная комбинация источник+GUID\
user_sources(user_id, source_id) - уникальная пара пользователь-источник\
sent_news(user_id, news_id) - уникальная пара пользователь-новость
# Пользовательские роли
- user
- admin
## Для каждой роли - наименование, ответственность, количество пользователей в этой роли?
1. Роль: user (обычный пользователь)
- Регистрация и управление своим профилем
- Просмотр доступных источников новостей
- Подписка/отписка на источники
- Просмотр новостей из своих подписок
- Добавление новых источников
- Ручное обновление новостей

Количество пользователей: Неограничено

2. Роль: admin (администратор)
- Все права обычного пользователя
- Просмотр списка всех пользователей
- Назначение/снятие прав администратора
- Управление категориями (добавление/удаление)
- Управление источниками (активация/деактивация, удаление)
- Просмотр системной статистики

Количество пользователей: Ограничено (~5-10% от общего числа пользователей)
# UI / API
### API (RESTful)
Фреймворк: Gin Web Framework\
Аутентификация: JWT (JSON Web Tokens)\
Формат данных: JSON\
Код состояния HTTP: Полная поддержка REST кодов\
Основные группы эндпоинтов:
```text
/auth/...        # Аутентификация
/user/...        # Пользовательские данные
/news/...        # Новости/подписки
/sources/...     # Источники
/admin/...       # Функции админа
```
### Telegram Bot UI
Библиотека: go-telegram-bot-api\
Типы интерфейса:\
Команды (/start, /help, ...)\
Inline-кнопки для управления подписками\
Reply-клавиатуры для быстрого доступа\
Inline-навигация для пагинации\
Поддержка форматов: Markdown\
Медиа: Поддержка ссылок
# Технологии разработки
## Язык программирования
### Go
## СУБД
### PostgreSQL
# Тестирование
- Ручное тестирование
- Unit-тесты